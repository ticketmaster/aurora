after_success:
  - npx codecov
branches:
  only:
    - gh-pages
    - /.*/
cache:
  directories:
    - node_modules
deploy:
  - provider: script
    cleanup: false
    on:
      branch: master
      condition: type != pull_request
    script: npx semantic-release
  - provider: pages
    cleanup: false
    keep_history: true
    local_dir: catalog/build
    on:
      branch: master
      condition: type != pull_request
    target_branch: gh-pages
    token: $GITHUB_TOKEN
    strategy: git
dist: xenial
jobs:
  include:
    - stage: lint
      script:
        - npm run lint
        - npm run lint:css
    - stage: test branch
      script:
      - git fetch --no-tags --depth=1 origin master
      - git checkout -b master
      - git checkout $GITHUB_REF
      - npm run test:ci
      if: branch != master
    - stage: test master
      script:
        - npm run test:ci
      if: branch = master
    - stage: build
      script:
        - npm run build
        - npm run catalog-build
language: node_js
os: linux
notifications:
  email: false
